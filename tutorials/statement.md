# 语句和表达式

- [语句和表达式](#语句和表达式)
  - [1. 简介](#1-简介)
  - [2. 语句](#2-语句)
  - [3. 表达式](#3-表达式)
  - [4. 示例](#4-示例)

2023-10-31, 21:18
@author Jiawei Mao
****

## 1. 简介

Rust 函数由一系列语句组成，最后由一个表达式返回值。例如：

```rust
fn add_with_extra(x: i32, y: i32) -> i32 {
    let x = x + 1; // 语句
    let y = y + 5; // 语句
    x + y // 表达式
}
```

**语句**执行操作但不返回值，而**表达式**在计算后会返回一个值，因此在上述函数的三行代码中，前两行是语句，最后一行是表达式。

函数体由一系列语句（statement）组成，结尾可以包含一个表达式（expression）：

- 语句（Statement）：执行某些操作但不返回值的指令
- 表达式（Expression）：求值返回结果

## 2. 语句

创建变量并用 `let` 关键字为其赋值就是语句。示例：

```rust
let a = 8;
let b: Vec<f64> = Vec::new();
let (a, c) = ("hi", false);
```

函数定义也是语句。语句不返回值，因此不能将语句赋值给另一个变量。例如，下面是**错的**：

```rust
fn main() {
    let x = (let y = 6);
}
```

`let y = 6` 语句不返回值，因此没有任何东西可以绑定 `x`。不像 C 语言中，可以写 `x = y = 6`，让 x 和 y 的值都是 6。

## 3. 表达式

表达式返回一个值。例如 `5+6` 是一个表达式，返回值为 `11`。

- 表达式可以是语句的一部分，如 `let y = 6;`
- 调用函数是表达式，因为会返回值
- 调用宏是表达式
- 用大括号创建的新的 scope 也是表达式，例如

```rust
fn main() {
    let y = {
        let x = 3;
        x + 1
    };

    println!("The value of y is: {y}");
}
```

下面的表达式：

```rust
{
    let x = 3;
    x + 1
}
```

该表达式的值是 `4`，赋给 `y`。注意，`x+1` 行末没有分号，如果添加分号，就转换成了语句，不返回值。

表达式如果不返回值，会隐式返回一个 `()`：

```rust
fn main() {
    // 调用函数是表达式，但 `ret_unit_type` 不返回值，因此隐式返回 ()
    assert_eq!(ret_unit_type(), ()) 
}
fn ret_unit_type() {
    let x = 1;
    // if 语句块也是一个表达式，因此可以用于赋值，也可以直接返回
    // 类似三元运算符，在Rust里我们可以这样写
    let y = if x % 2 == 1 {
        "odd"
    } else {
        "even"
    };
    // 或者写成一行
    let z = if x % 2 == 1 { "odd" } else { "even" };
}
```

## 4. 示例

- 表达式作为 scope 返回值

```rust
fn main() {
    let v = {
        let mut x = 1;
        x += 2;
        x // 该语句作为当前 scope 的返回值
    };

    assert_eq!(v, 3);
}
```

- 表达式作为函数返回值

```rust
fn main() {
    let s = sum(1 , 2);
    assert_eq!(s, 3);
}

fn sum(x: i32, y: i32) -> i32 {
    x + y
}
```